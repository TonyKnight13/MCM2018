# 1 Introduction

### 1.1 Restatement of Problem
<!-- 已在英文论文中完成 -->
i
### 1.2 problem background

随着互联网技术的不断发展，其影响已渗透至生活中的方方面面。在这样的背景下，互联网金融应运而生，与传统金融相比，它有着使人青睐的优点，比如，达到更快的业务处理速度，突破时间与空间的约束，提供更快捷便利的金融服务，带给用户更好的服务体验。但与此同时，它所带来的风险也日益显现，比如信用风险与用户诈骗这样的问题，在这个背景下，一套完善有效的信用评分体系显得尤为重要。

### 1.3 Our Work

信用评分是指根据客户的信用历史资料，利用一定的信用评分模型，得到不同等级的信用分数。根据客户的信用分数，信用评估者可以分析客户按时还款的可能性。虽然信用评估者通过分析客户的信用历史资料，同样可以得到这样的分析结果，但利用信用评分却更加快速、更加客观、更具有准确性。

考虑到现今的商业信用评分模型经常使用的是逻辑斯蒂回归算法，我们主要尝试该算法和决策树算法来训练，把重点放在了数据清洗和变量选择与构造上。变量选择的一些决策主要建立行业中常用的信用评分的筛选工作。针对给定的数据，我们主要做以下的思考：

- 这些历史业务数据中，哪些字段是无法使用的数据。
- 如何处理'是否违约'比例不均衡。
- 如何让模型在数据量并大的前提下更充分训练。
- 如何评估数据对模型训练是否有促进作用。 
- 如何把部分数据做某些转换，使其更加适合训练。
- 如何训练算法的参数以应对该问题的调整。

后面的内容会体现以上所列。

# 2 Assumptions

- 假设该贷款机构的历史业务数据是稳定，可信赖的。
- 假设是否违约不受突发事件影响。
- 假设所有借款人之前的信用记录良好。
- 假设所有借款人身份都是普通人，每个人的财产都由后期工作积累获得。

# 3 Notations

# 4 Data Processing

### 4.1 Data Screening

数据量很大，因此我们的首要任务是根据数据的完整性和有效性进行数据筛选。

首先，我们对该贷款机构提供的30000条历史业务数据进行数据筛选：

- 我们删除掉了第一列REPORT_ID这项在我们分析中没有任何实际意义的属性。
- 由于标签属性至关重要，且无法补全，所以我们删除掉没有注明是否违约的业务数据。
- 在对属性的分析中发现，数据中大量缺失AGENT和薪资水平两个属性，其中薪资水平由于是有连续意义的数值型属性，所以可以补全，而对于AGENT，由于其是文本类型数据，且未发现其与其他属性有相关关系，所以我们选择删除掉AGENT该项属性。
- 违约和未违约的数据比例不均衡，考虑到许多训练模型需要样本均衡，所以需要采取一定的策略来平衡数据。该类别比例约为1：25，所以我们在之后的同时采用欠采样和过采样的策略。
<!-- 没有定量分析 -->

### 4.2 Data merging

- 在对数据处理中我们发现，在教育水平变量中，存在着专科及以下、专科、高中和初中四种分类定义重复的现象，其中重复的还有硕士研究生、博士研究生和硕士及以上三种分类定义，所以我们将前者合并为一类，后者合并为另一类。
- 同时我们发现，在婚姻状况中出现离婚和离异两种分类定义重复，我们将其合并为离婚，同时我们考虑对婚姻状况的语义描述，我们将丧偶合并到离婚中，将其他合并到未婚中。
- 对于借款时间，提供给我们的数据中只有2017年的一月到六月，所以我们把日期按月来表示，以方便后期使用。
- 对于身份证信息，由于已经提供了工作省份和是否是本地籍的数据，所以我们可以从这两项属性中提取出有关出生地的信息，且根据假设出生地对人没有影响，所以我们只保留了身份证中有关性别的信息。
- 对于工作省份，我们根据中国共产党的十六大对全国经济区域的划分，参考各省份经济去年发展状况（如图），将全国省份划分为东部、东北、中部和西部四个大范围，如图所示。

<!-- 图1 -->

### 4.3 Missing Value Processing

在我们使用的数据中，有大量的数据缺失了工资等级这一项变量，由于缺少数据量大并且该项变量是具有有序性的数值型数据，所以我们考虑将其补全。我们对已有数据进行统计，发现总体上数据呈正态分布。

然后我们考虑到薪资等级可能受到教育水平和工作区域的影响，所以我们假设不同教育水平和工作区域的人薪资等级不同，并且对其进行分析。


图


图


图

我们发现，在不同的教育水平中，薪资水平基本都呈正态分布。在硕士及以上教育水平中的高薪资水平的比例与其他教育水平相比较高，但考虑到到该教育水平的数据量在总数据中所占比例较低，为了方便处理，我们也将其薪资水平近似看为呈正态分布。因此我们取不同教育水平中薪资水平的众数来填充。

而对于不同的工作地域，我们分别对其薪资水平进行分析。

图


图


图


图

我们也发现，在不同的工作区域中，所有的薪资水平都呈现正态分布，因此我们得出该数据中的薪资水平整体呈现正态分布的结论，不受教育水平和工作区域太大影响。

对此，我们计算出它们的平均数和众数并绘制相关图表进行初步分析。可以看到平均数为3.58，众数为3。考虑各方面以及方便我们后期使用，我们决定将所有薪资等级的缺失值设置为3。

表


### 4.4 Unbalanced data processing

对数据标签量进行统计发现，没有违约的数量远远大于违约的数量，这很容易使得我们的模型在训练时将结果全部预测为没有违约，最终正确率表面上高达0.9，但实际对违约的预测准确率基本为0，为了避免这种现象发生，我们对数据进行了欠采样和过采样的处理，减少两类客户的样本差距。我们尝试进行多次的过采样和欠采样。总体上的策略是，对没有违约客户的数据欠采样应该尽可能保留多的原样本，对违约客户的数据过采样不应该远超过原样本的数量。

图


# 5 Our Model

经过之前的数据的简单预处理，现在的数据项如下：


根据现有的资料，考虑到现在的信用评分模型及该行业对信用评分模型的可解释性的要求。我们初步考虑的模型是logistic回归。

该数据中，婚姻状况不能简单的用序列号来表示，这样会造成某些婚姻状况相近但实际情况并不是。而婚姻属性本身没有顺序性，于是我们对其进行One-Hot编码。同理，考虑学历数据本身处理后变的粗略，而学历高低顺序性变得模糊，我们也将学历进行One-Hot编码。最后是考虑省份数据，给我们的数据中省份是一个6位数邮编号。根据观察，邮编最左边2位号代表了其省份，于是，我们把该数据进行了转换，得到了客户的省编号。考虑到中国省份非常多，我们查阅了相关的资料，发现中国分为四大经济区域：东部地区、东北地区、中部地区和西部地区。各地区经济社会发展的主要内容为：西部开发、东北振兴、中部崛起、东部率先发展。考虑到贷款、信用评分与经济紧密，我们对省份数据进行了分箱：

<!-- 这里是否需要写到论文里 -->
东北地区（黑龙江省、吉林省、辽宁省、内蒙古自治区东部的呼伦贝尔市、兴安盟、通辽市、赤峰市、锡林郭勒盟）

中部地区（山西省、河南省、湖北省、湖南省、江西省、安徽省）

东部地区（北京市、天津市、河北省、山东省、江苏省、上海市、浙江省、福建省、广东省、海南省）

西部地区（四川省、广西壮族自治区、贵州省、云南省、重庆市、陕西省、甘肃省、内蒙古自治区西部、宁夏回族自治区、新疆维吾尔自治区、青海省、西藏自治区）

以下是根据身份证前两位进行的编码：

东北：21,22,23

中部：14,41,42,43,36,34

东部：11,12,13,37,32,31,33,35,44,46

西部地区：51,45,52,53,50,61,62,15,64,65,63,54

省份之间其实也无顺序性，所以我们再次对该数据进行了One-Hot编码。
<!-- 无数据依据 -->



经过以上几步，现在的数据应该是可以训练的了。但是在训练之前，我们仍然需要做一定的特征工程。

我们使用了一种行业经常用的基于IV值进行筛选的方式。

首先引入概念和公式。

IV的全称是Information Value，求IV值得先求woe值，这里又引入woe的概念。

WOE(weight of Evidence)其实就是自变量取某个值的时候对违约比例的一种影响，WOE编码之后，自变量其实具备了某种标准化的性质，也就是说，自变量内部的各个取值之间都可以直接进行比较（WOE之间的比较），而不同自变量之间的各种取值也可以通过WOE进行直接的比较。进一步地，可以研究自变量内部WOE值的变异（波动）情况，结合模型拟合出的系数，构造出各个自变量的贡献率及相对重要性。一般地，系数越大，woe的方差越大，则自变量的贡献率越大（类似于某种方差贡献率），这也能够很直观地理解。
总结起来就是，做信用评分模型时，自变量的处理过程（包括编码与筛选）很大程度上是基于对单变量模型效果的评价。而在这个评价过程中，ROC与IV是从不同角度考察自变量对目标变量的影响力，基于这种考察，我们用WOE值对分类自变量进行编码，从而能够更直观地理解自变量对目标变量的作用效果及方向，同时提升预测效果。

WOE转化的优势：提升模型的预测效果，提高模型的可理解性。

首先把变量分组（怎么分后面说），然后对于每个组i，对于第i组有：

$woe_i = \ln(\frac{B_i / B_T}{G_i / G_T}) $
<!-- WOE公式 -->

比如如果只用woe的绝对值求和，如果一些分组中，A组数量很小，B组数量很大（显然这样的分组不合理），这是B的woe值就很小，A组很大，求和的woe也不会小，显然这样不合理。

$IV_i = (\frac{B_i}{B_T} - \frac{G_i}{G_T}) * woe_i$
<!-- IV -->

最后我们可以根据每个变量IV值的大小排序去筛选变量。IV越大的越要保留。

以信用评分卡的建模场景为例：X是客户样本字段，Y表示客户逾期与否，其中Y=1代表逾期，Y=0代表未逾期。 我们希望能用客户已知的信息来预测客户借款后发生逾期的概率，以此来决定是否放贷。
<!-- 公式和我们的数据计算 -->

我们对之前数据计算各个属性字段的WOE值，然后根据WOE值计算相应的IV值。IV衡量的是某个变量的信息量。IV可以用来表示一个变量的预测能力。
<!-- 公式和我们的数据计算 -->

经过IV的计算后，我们根据IV大小进行排序，根据IV值选择里面的部分变量进行WOE编码。

<!-- 这里写编码情况 -->

<!-- 这里写logistic回归 -->


# 6 结果分析

### 6.1问题一

对各属性与违约情况进行卡方检验后，我们惊奇的发现性别、婚姻状况与是否拥有基金与结果并无明显关系，也就是说这三个属性的权重几乎为0
另外为了哪个数据中剩余的因素对是否违约的影响大，我们需要分析各属性的权重，通过结果，我们发现最重要的因素是薪资水平，也就是说薪资水平使我们信用评价系统最主要因素。剩余因素影响信用评价系统的重要性的排序依次为：

<!-- 卡方检验 -->

- 薪资水平
- 工作省份
- 教育水平
- 是否本地
- 借款时间

### 6.2问题三
<!-- 这些是logistic的 -->
通过对测试数据的预测，得到精确率为0.74，召回率为0.51，总体预测正确率为0.62（如图），总体来说效果并不好。但对与信用评估预测违约的问题来说，更看重召回率，所以0.51的召回率也基本满足需求。
<!-- 表    结果分析 -->


画出其ROC曲线图可以看出该模型能够简单的预测是否违约。但在模型建立的过程中，由于数量量比真实情况少，所以模型只能在一定程度上检测模型的正确性
<!-- 图    ROC曲线图 -->


<!-- 决策树部分 -->


# 7 模型评价与改进

### 7.1模型的优点
- 建立的预测模型能与实际紧密相连，结合实际情况对问题进行求解，使得模型具有很好的通用性和推广性
- 模型的计算采用专业的数学分析软件，可行度较高
- 对数据进行了仔细的处理，对变量重新编码，便用后面模型使用
- 对模型中涉及到的众多影响因素进行了量化分析，使得论文有说服力

### 7.2模型的缺点
- 对训练算法要求低，但是对数据本身要求高，因此特征工程有较高难度，导致最终效果不理想。
- 对数据中的变量没有做详细的相关性检验，导致一些变量的显著性较高
- 对于本问题，所引入的外部资料比较多，自己创造的东西较少。
- 由于时间关系，没有很好的把握论文的中心，让人感觉论文有点散，未能进行全面修改。

### 7.3模型的改进
<!-- - 由于时间问题，调参不够完善，后续可以慢慢调参，并简化模型 -->
- logistic回归在该问题对数据有强依赖，因此可以考虑使用决策来训练。


<!-- 这里写决策树 -->
鉴于logistic回归表现不佳,我们之后使用决策树算法来训练并做一些微调。

决策树算法的常见优点如下：
- 分类精度高；
- 生成的模式简单；
- 对噪声数据有很好的健壮性。

我们选择gini系数来作为划分依据，基尼指数（基尼不纯度）：表示在样本集合中一个随机选中的样本被分错的概率。
<!-- 这里可能需要说下信息熵、基尼系数和公式 -->

<!-- 说明:

1. pk表示选中的样本属于k类别的概率，则这个样本被分错的概率是(1-pk)

2. 样本集合中有K个类别，一个随机选中的样本可以属于这k个类别中的任意一个，因而对类别就加和

3. 当为二分类是，Gini(P) = 2p(1-p) -->


整体上数据如之前一致，调整了测试后如下：

混淆矩阵： 

[[2894 1165]
[1304 2637]]

各种评价指标
acc 0.691375
recall 0.669119512814
precision 0.693582325092

可以看出，相对之前的logistic回归，整体上提升较大。此时，由于坏客户的样本数量相对较少产生的影响大大减少了。不会出现总是倾向于评价为好客户的情况。看样子，过采样和欠采样在决策树的作用更加明显。而从网络上获取的常见信用评价指标显示60%就是可以接受的，70%效果不错。

<!-- 这里放那张信用评价指标图 -->

# 参考文献

http://bbs.pinggu.org/thread-5902605-1-1.html
# 附录